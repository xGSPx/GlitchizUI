--[[
    GlitchizUI v5.1 (The Definitive Refactor)
    - FIXED: Dropdown was completely rebuilt using a professional ZIndex layering method. It no longer pushes content down but appears cleanly OVER it.
    - FIXED: The dropdown is now fully scrollable and correctly sized.
    - This is the definitive, stable build incorporating all previous bug fixes.
--]]

local Library = {}
Library.__index = Library

-- // Theme Configuration
local Theme = {
    Background = Color3.fromRGB(20, 18, 28),      
    Header = Color3.fromRGB(45, 35, 65),          
    Accent = Color3.fromRGB(110, 70, 220),        
    Accent2 = Color3.fromRGB(0, 240, 255),        
    Text = Color3.fromRGB(255, 255, 255),         
    Font = Enum.Font.SourceSans,
    BoldFont = Enum.Font.SourceSansBold,
    TextSize = 14,
}

-- // Main Window Constructor
function Library.new(properties)
    local Window = {}
    local self = setmetatable(Window, Library)

    -- // Services are loaded inside .new() to prevent timing-related startup crashes.
    local UserInputService = game:GetService("UserInputService")
    local TweenService = game:GetService("TweenService")
    local CoreGui = game:GetService("CoreGui")

    -- // Helper function to create new instances with properties
    local function Create(instanceType, props) 
        local instance = Instance.new(instanceType)
        for property, value in pairs(props or {}) do
            instance[property] = value
        end
        return instance
    end

    -- // Helper function for animations
    local function Animate(instance, newProperties, duration) 
        local tweenInfo = TweenInfo.new(duration or 0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(instance, tweenInfo, newProperties)
        tween:Play()
        return tween
    end

    -- // Helper function to make a frame draggable
    local function MakeDraggable(object, handle)
        local isDragging = false
        local dragStart, objectStartPos

        handle.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                isDragging = true
                dragStart = input.Position
                objectStartPos = object.Position
                
                local connection 
                connection = input.Changed:Connect(function() 
                    if input.UserInputState == Enum.UserInputState.End then 
                        isDragging = false 
                        connection:Disconnect() 
                    end 
                end)
            end
        end)

        UserInputService.InputChanged:Connect(function(input)
            if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - dragStart
                object.Position = UDim2.new(objectStartPos.X.Scale, objectStartPos.X.Offset + delta.X, objectStartPos.Y.Scale, objectStartPos.Y.Offset + delta.Y)
            end
        end)
    end

    -- // Initialize Window Properties
    self.Title = properties.Title or "GlitchizUI"
    self.Tabs = {}
    self.Keybind = properties.Keybind or Enum.KeyCode.RightControl
    
    local isMobile = UserInputService.TouchEnabled and workspace.CurrentCamera.ViewportSize.X < 700
    self.Size = isMobile and UDim2.new(0.9, 0, 0.65, 0) or (properties.Size or UDim2.new(0, 550, 0, 350))

    -- // Create Core UI Structure
    self.ScreenGui = Create("ScreenGui", { Name = "GlitchizUI_ScreenGui", ZIndexBehavior = Enum.ZIndexBehavior.Global, Parent = CoreGui })
    
    self.MainFrame = Create("Frame", { Name = "MainFrame", Size = self.Size, Position = properties.Position or UDim2.new(0.5, -self.Size.X.Offset / 2, 0.5, -self.Size.Y.Offset / 2), BackgroundColor3 = Theme.Background, BackgroundTransparency = 0.15, BorderSizePixel = 0, Parent = self.ScreenGui })
    Create("UICorner", { CornerRadius = UDim.new(0, 6), Parent = self.MainFrame }); Create("UIStroke", { Color = Theme.Accent2, Transparency = 0.7, Thickness = 1.5, Parent = self.MainFrame })

    -- // Create Header (ZIndex 3 to be on top of everything)
    local header = Create("Frame", { Name = "Header", Size = UDim2.new(1, 0, 0, 40), BackgroundColor3 = Theme.Header, BackgroundTransparency = 0.2, BorderSizePixel = 0, ZIndex = 3, Parent = self.MainFrame })
    local dragFrame = Create("Frame", {Name = "DragFrame", Size = UDim2.new(1, -60, 1, 0), BackgroundTransparency = 1, Parent = header})
    Create("TextLabel", { Name = "Title", Size = UDim2.new(1, 0, 1, 0), Position = UDim2.new(0, 15, 0, 0), Text = self.Title, Font = Theme.BoldFont, TextSize = Theme.TextSize + 4, TextColor3 = Theme.Text, TextXAlignment = Enum.TextXAlignment.Left, BackgroundTransparency = 1, Parent = dragFrame })
    
    -- // Create Header Controls (Minimize, Close)
    local controls = Create("Frame", { Name = "Controls", Size = UDim2.new(0, 60, 1, 0), Position = UDim2.new(1, -60, 0, 0), BackgroundTransparency = 1, Parent = header })
    local hideButton = Create("TextButton", { Name = "HideButton", Size = UDim2.new(0, 30, 1, 0), BackgroundColor3 = Color3.new(), BackgroundTransparency = 1, Text = "—", Font = Theme.BoldFont, TextSize = 16, TextColor3 = Theme.Text, Parent = controls })
    local deleteButton = Create("TextButton", { Name = "DeleteButton", Size = UDim2.new(0, 30, 1, 0), Position = UDim2.new(0, 30, 0, 0), BackgroundColor3 = Color3.new(), BackgroundTransparency = 1, Text = "✕", Font = Theme.BoldFont, TextSize = 16, TextColor3 = Theme.Text, Parent = controls })
    
    -- // Create Main Content Area (ZIndex 1 to be below header)
    local contentContainer = Create("Frame", { Name = "ContentContainer", Size = UDim2.new(1, 0, 1, -40), Position = UDim2.new(0, 0, 0, 40), BackgroundTransparency = 1, ZIndex = 1, Parent = self.MainFrame })
    local tabContainer
    if isMobile then
        tabContainer = Create("ScrollingFrame", { Name = "TabContainer", Size = UDim2.new(1, 0, 0, 35), BackgroundColor3 = Theme.Background, BackgroundTransparency = 0.3, BorderSizePixel = 0, ScrollingDirection = Enum.ScrollingDirection.X, ScrollBarThickness = 0, Parent = contentContainer })
        Create("UIListLayout", { FillDirection = Enum.FillDirection.Horizontal, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5), VerticalAlignment = Enum.VerticalAlignment.Center, Parent = tabContainer })
        self.ContentFrame = Create("Frame", { Name = "ContentFrame", Size = UDim2.new(1, 0, 1, -35), Position = UDim2.new(0, 0, 0, 35), BackgroundTransparency = 1, ClipsDescendants = true, Parent = contentContainer})
    else
        tabContainer = Create("ScrollingFrame", { Name = "TabContainer", Size = UDim2.new(0, 120, 1, 0), BackgroundColor3 = Theme.Background, BackgroundTransparency = 0.3, BorderSizePixel = 0, ScrollingDirection = Enum.ScrollingDirection.Y, ScrollBarThickness = 2, Parent = contentContainer })
        Create("UIListLayout", { FillDirection = Enum.FillDirection.Vertical, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5), HorizontalAlignment = Enum.HorizontalAlignment.Center, Parent = tabContainer })
        self.ContentFrame = Create("Frame", { Name = "ContentFrame", Size = UDim2.new(1, -120, 1, 0), Position = UDim2.new(0, 120, 0, 0), BackgroundTransparency = 1, ClipsDescendants = true, Parent = contentContainer})
    end

    -- // Connect Core Window Events
    MakeDraggable(self.MainFrame, dragFrame)
    
    function self:Destroy() if self.ScreenGui then self.ScreenGui:Destroy() end; for i,v in pairs(self) do self[i]=nil; setmetatable(self, nil) end end
    local isContentVisible = true
    local function ToggleMinimize()
        isContentVisible = not isContentVisible
        contentContainer.Visible = isContentVisible
        Animate(self.MainFrame, { Size = isContentVisible and self.Size or UDim2.new(self.Size.X.Scale, self.Size.X.Offset, 0, 40) }, 0.2)
        hideButton.Text = isContentVisible and "—" or "+"
    end
    hideButton.MouseButton1Click:Connect(ToggleMinimize)
    deleteButton.MouseButton1Click:Connect(function() self:Destroy() end)
    
    local function ToggleVisibility() self.MainFrame.Visible = not self.MainFrame.Visible end
    UserInputService.InputBegan:Connect(function(input, gameProcessed) 
        if not gameProcessed and input.KeyCode == self.Keybind then 
            ToggleVisibility() 
        end 
    end)
    
    -- // Tab Management
    local isTweeningTab = false
    function self:AddTab(name)
        local Tab = {}
        
        local buttonSize = isMobile and UDim2.new(0, 100, 1, -10) or UDim2.new(1, -10, 0, 30)
        Tab.Button = Create("TextButton", { Name = name, Size = buttonSize, Text = name, Font = Theme.BoldFont, TextSize = Theme.TextSize, TextColor3 = Theme.Text, BackgroundColor3 = Theme.Header, BorderSizePixel = 0, LayoutOrder = #self.Tabs + 1, Parent = tabContainer }); Create("UICorner", { CornerRadius = UDim.new(0, 4), Parent = Tab.Button })
        
        local indicatorSize = isMobile and UDim2.new(0.6, 0, 0, 3) or UDim2.new(0, 3, 0.6, 0)
        local indicatorPos = isMobile and UDim2.new(0.2, 0, 1, -3) or UDim2.new(0, 0, 0.2, 0)
        Tab.Indicator = Create("Frame", { Name = "Indicator", Size = indicatorSize, Position = indicatorPos, BackgroundColor3 = Theme.Accent2, BorderSizePixel = 0, Visible = false, Parent = Tab.Button }); Create("UICorner", { Parent = Tab.Indicator })

        Tab.ContentFrame = Create("ScrollingFrame", { Name = name .. "_Content", Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1, BorderSizePixel = 0, CanvasSize = UDim2.new(0, 0, 0, 0), ScrollBarImageColor3 = Theme.Accent2, ScrollBarThickness = 4, Parent = self.ContentFrame, Visible = false });
        local listLayout = Create("UIListLayout", { FillDirection = Enum.FillDirection.Vertical, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 10), HorizontalAlignment = Enum.HorizontalAlignment.Left, Parent = Tab.ContentFrame })
        Create("UIPadding", {PaddingTop = UDim.new(0, 15), PaddingLeft = UDim.new(0, 15), Parent = Tab.ContentFrame})
        
        Tab.Button.MouseButton1Click:Connect(function()
            if self.ActiveTab == Tab or isTweeningTab then return end
            isTweeningTab = true
            
            local oldTab = self.ActiveTab
            if oldTab then 
                oldTab.Button.BackgroundColor3 = Theme.Header
                oldTab.Indicator.Visible = false
                Animate(oldTab.ContentFrame, {Position = UDim2.new(-1, 0, 0, 0)}, 0.2)
            end
            
            Tab.ContentFrame.Position = UDim2.new(1, 0, 0, 0)
            Tab.ContentFrame.Visible = true
            Tab.Button.BackgroundColor3 = Theme.Accent
            Tab.Indicator.Visible = true
            
            Animate(Tab.ContentFrame, {Position = UDim2.new(0, 0, 0, 0)}, 0.2).Completed:Wait()
            if oldTab then oldTab.ContentFrame.Visible = false end
            
            self.ActiveTab = Tab
            isTweeningTab = false
        end)
        
        if not self.ActiveTab then
            Tab.Button.BackgroundColor3 = Theme.Accent
            Tab.Indicator.Visible = true
            Tab.ContentFrame.Visible = true
            Tab.ContentFrame.Position = UDim2.new(0,0,0,0)
            self.ActiveTab = Tab
        end
        
        self.Tabs[name] = Tab

        -- // Element Creation Methods for this Tab object
        local elementMethods = {}
        
        local function AddElement(height)
            local elementFrame = Create("Frame", {
                Size = UDim2.new(1, -30, 0, height),
                BackgroundTransparency = 1,
                LayoutOrder = #Tab.ContentFrame:GetChildren(),
                Parent = Tab.ContentFrame
            })
            task.wait() -- Let the layout update before calculating canvas size
            Tab.ContentFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 30)
            return elementFrame
        end

        function elementMethods:AddLabel(labelProps) 
            local frame = AddElement(20)
            Create("TextLabel",{Size = UDim2.new(1,0,1,0),Text = labelProps.Text or "Label",Font = labelProps.Bold and Theme.BoldFont or Theme.Font,TextSize = labelProps.Big and Theme.TextSize + 4 or Theme.TextSize,TextColor3 = labelProps.Color or Theme.Text,TextXAlignment = Enum.TextXAlignment.Left,BackgroundTransparency = 1,Parent = frame})
            return {}
        end

        function elementMethods:AddDivider() 
            local frame = AddElement(8)
            Create("Frame", { Size=UDim2.new(1,0,0,1), Position=UDim2.new(0.5,0,0.5,0), AnchorPoint=Vector2.new(0.5,0.5), BackgroundColor3=Theme.Accent, BackgroundTransparency=0.5, BorderSizePixel=0, Parent=frame})
        end

        function elementMethods:AddButton(buttonProps) 
            local frame = AddElement(35)
            local button = Create("TextButton", { Name="Button", Size=UDim2.new(1,0,1,0), Text=buttonProps.Text or "Button", Font=Theme.Font, TextSize=Theme.TextSize, TextColor3=Theme.Text, BackgroundColor3=Theme.Header, Parent=frame})
            Create("UICorner", {CornerRadius=UDim.new(0,4), Parent=button})
            local stroke = Create("UIStroke", {Color=Theme.Accent, Parent=button})
            if buttonProps.Callback then button.MouseButton1Click:Connect(function() pcall(buttonProps.Callback) end) end
            button.MouseEnter:Connect(function() Animate(stroke, {Color=Theme.Accent2}) end)
            button.MouseLeave:Connect(function() Animate(stroke, {Color=Theme.Accent}) end)
            return {}
        end

        function elementMethods:AddToggle(toggleProps) 
            local frame = AddElement(25)
            local toggleObject = {Value = toggleProps.Default or false}
            Create("TextLabel", {Size=UDim2.new(1,-35,1,0), Position=UDim2.new(0,35,0,0), Text=toggleProps.Text or "Toggle", Font=Theme.Font, TextSize=Theme.TextSize, TextColor3=Theme.Text, TextXAlignment=Enum.TextXAlignment.Left, BackgroundTransparency=1, Parent=frame})
            local button = Create("TextButton", {Name="Toggle", Size=UDim2.new(0,25,0,25), Position=UDim2.new(0,0,0.5,0), AnchorPoint=Vector2.new(0,0.5), BackgroundColor3=Theme.Header, Text="", Parent=frame})
            Create("UICorner", {CornerRadius=UDim.new(0,4), Parent=button})
            local stroke = Create("UIStroke",{Color=Theme.Accent, Parent=button})
            local checkmark = Create("Frame",{Name="Checkmark", Size=UDim2.new(0.6,0,0.6,0), Position=UDim2.new(0.5,0,0.5,0), AnchorPoint=Vector2.new(0.5,0.5), BackgroundColor3=Theme.Accent2, Visible=toggleObject.Value, Parent=button})
            Create("UICorner", {CornerRadius=UDim.new(0,2), Parent=checkmark})
            button.MouseButton1Click:Connect(function() toggleObject.Value = not toggleObject.Value; checkmark.Visible = toggleObject.Value; if toggleProps.Callback then pcall(toggleProps.Callback, toggleObject.Value) end end)
            button.MouseEnter:Connect(function() Animate(stroke, {Color=Theme.Accent2}) end)
            button.MouseLeave:Connect(function() Animate(stroke, {Color=Theme.Accent}) end)
            return toggleObject
        end

        function elementMethods:AddTextbox(textboxProps) 
            local frame = AddElement(35)
            local boxFrame = Create("Frame", {Size=UDim2.new(1,0,1,0), BackgroundColor3=Theme.Header, Parent=frame}); Create("UICorner", {CornerRadius=UDim.new(0,4), Parent=boxFrame}); Create("UIStroke", {Color=Theme.Accent, Parent=boxFrame})
            local textbox = Create("TextBox", {Name="Textbox", Size=UDim2.new(1,-85,1,0), Position=UDim2.new(0,5,0,0), Text=textboxProps.Default or"", PlaceholderText=textboxProps.Placeholder or"...", Font=Theme.Font, TextSize=Theme.TextSize, TextColor3=Theme.Text, BackgroundTransparency=1, ClearTextOnFocus=textboxProps.ClearOnFocus or false, Parent=boxFrame})
            local submitButton = Create("TextButton", {Name="Submit", Size=UDim2.new(0,70,0.8,0), Position=UDim2.new(1,-75,0.1,0), Text=textboxProps.ButtonText or"Submit", Font=Theme.Font, TextSize=Theme.TextSize-1, TextColor3=Theme.Text, BackgroundColor3=Theme.Accent, Parent=boxFrame}); Create("UICorner", {CornerRadius=UDim.new(0,4), Parent=submitButton})
            local function FireCallback() if textboxProps.Callback then pcall(textboxProps.Callback, textbox.Text) end end
            textbox.FocusLost:Connect(function(enterPressed) if enterPressed then FireCallback() end end)
            submitButton.MouseButton1Click:Connect(FireCallback)
            return {}
        end
        
        function elementMethods:AddSlider(sliderProps)
            local frame = AddElement(45)
            local min, max, value = sliderProps.Min or 0, sliderProps.Max or 100, sliderProps.Default or 50
            local label = Create("TextLabel", {Size=UDim2.new(1,0,0,20), Text=(sliderProps.Text or "Slider")..": "..math.floor(value), Font=Theme.Font, TextSize=Theme.TextSize, TextColor3=Theme.Text, TextXAlignment=Enum.TextXAlignment.Left, BackgroundTransparency=1, Parent=frame})
            local track = Create("Frame", {Name="Track", Size=UDim2.new(1,0,0,6), Position=UDim2.new(0,0,0,25), BackgroundColor3=Theme.Header, Parent=frame}); Create("UICorner",{Parent=track})
            local progress = Create("Frame", {Name="Progress", Size=UDim2.new((value-min)/(max-min), 0, 1, 0), BackgroundColor3=Theme.Accent2, Parent=track}); Create("UICorner",{Parent=progress})
            local handle = Create("Frame", {Name="Handle", Size=UDim2.new(0,12,0,12), Position=UDim2.new(1,0,0.5,0), AnchorPoint=Vector2.new(0.5,0.5), BackgroundColor3=Theme.Text, Parent=progress}); Create("UICorner",{CornerRadius=UDim.new(1,0), Parent=handle})
            local isDragging = false
            local inputChangedConnection, inputEndedConnection
            local function UpdateSlider(inputPosition) local relativeX=inputPosition.X-track.AbsolutePosition.X; local percentage=math.clamp(relativeX/track.AbsoluteSize.X,0,1); value=min+(max-min)*percentage; Animate(progress,{Size=UDim2.new(percentage,0,1,0)},0.05); label.Text=(sliderProps.Text or"Slider")..": "..math.floor(value); if sliderProps.Callback then pcall(sliderProps.Callback,value)end end
            track.InputBegan:Connect(function(input) if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then isDragging=true; UpdateSlider(input.Position); inputChangedConnection=UserInputService.InputChanged:Connect(function(changedInput) if isDragging and(changedInput.UserInputType==Enum.UserInputType.MouseMovement or changedInput.UserInputType==Enum.UserInputType.Touch)then UpdateSlider(changedInput.Position)end end); inputEndedConnection=UserInputService.InputEnded:Connect(function(endedInput) if endedInput.UserInputType==Enum.UserInputType.MouseButton1 or endedInput.UserInputType==Enum.UserInputType.Touch then isDragging=false; if inputChangedConnection then inputChangedConnection:Disconnect() end; if inputEndedConnection then inputEndedConnection:Disconnect() end end end) end end)
            return {}
        end

        function elementMethods:AddDropdown(dropdownProps)
            local frame = AddElement(35)
            local isOpen = false
            
            local mainButton = Create("TextButton", {Name="DropdownMain", Size=UDim2.new(1,0,1,0), Text="  ".. (dropdownProps.Default or "Select an Option"), Font=Theme.Font, TextSize=Theme.TextSize, TextColor3=Theme.Text, BackgroundColor3=Theme.Header, TextXAlignment=Enum.TextXAlignment.Left, Parent=frame}); Create("UICorner", {CornerRadius=UDim.new(0,4), Parent=mainButton}); Create("UIStroke", {Color=Theme.Accent, Parent=mainButton})
            local arrow = Create("TextLabel", {Name="Arrow", Size=UDim2.new(0,30,1,0), Position=UDim2.new(1,-30,0,0), BackgroundTransparency=1, Font=Theme.BoldFont, Text="▼", TextColor3=Theme.Text, TextSize=12, Parent=mainButton})
            
            local optionsContainer = nil -- Lazily create this only when needed
            
            local function CloseDropdown()
                if not optionsContainer then return end
                isOpen = false
                Animate(arrow, {Rotation = 0}) 
                local anim = Animate(optionsContainer, {Size=UDim2.new(optionsContainer.Size.X.Scale, optionsContainer.Size.X.Offset, 0, 0)}, 0.2)
                anim.Completed:Connect(function() if optionsContainer then optionsContainer.Visible = false end end)
            end
            
            mainButton.MouseButton1Click:Connect(function()
                if not optionsContainer then -- First time opening, create the options
                    local maxDropdownHeight = 150
                    local optionHeight = 32
                    local totalOptionsHeight = #dropdownProps.Options * optionHeight
                    local visibleOptionsHeight = math.min(totalOptionsHeight, maxDropdownHeight)

                    optionsContainer = Create("ScrollingFrame", {
                        Name="Options", 
                        Size=UDim2.new(frame.AbsoluteSize.X, 0, 0, 0), 
                        Position=UDim2.fromOffset(frame.AbsolutePosition.X, frame.AbsolutePosition.Y + frame.AbsoluteSize.Y + 5),
                        BackgroundColor3=Theme.Background, 
                        BackgroundTransparency=0.1, 
                        BorderSizePixel=0, 
                        ClipsDescendants=true, 
                        Visible=false, 
                        CanvasSize=UDim2.new(0,0,0, totalOptionsHeight), 
                        ScrollBarImageColor3=Theme.Accent2, 
                        ScrollBarThickness=4, 
                        ZIndex = 10, -- High ZIndex to ensure it's on top
                        Parent=self.ScreenGui -- Parent to ScreenGui to float over everything
                    })
                    Create("UICorner", {CornerRadius=UDim.new(0,4), Parent=optionsContainer}); Create("UIStroke", {Color=Theme.Accent, Parent=optionsContainer});
                    local listLayout = Create("UIListLayout", {Padding=UDim.new(0,4), HorizontalAlignment=Enum.HorizontalAlignment.Stretch, Parent=optionsContainer})
                    Create("UIPadding", {PaddingLeft=UDim.new(0,4), PaddingRight=UDim.new(0,4), Parent=optionsContainer})

                    for _, optionText in ipairs(dropdownProps.Options or {}) do
                        local optionButton = Create("TextButton", {Name=optionText, Size=UDim2.new(1,0,0,28), Text="  "..optionText, Font=Theme.Font, TextSize=Theme.TextSize-1, TextColor3=Theme.Text, BackgroundColor3=Theme.Header, TextXAlignment=Enum.TextXAlignment.Left, AutoButtonColor=false, Parent=optionsContainer})
                        Create("UICorner", {CornerRadius=UDim.new(0,2), Parent=optionButton})
                        optionButton.MouseEnter:Connect(function() Animate(optionButton, {BackgroundColor3 = Theme.Accent}, 0.1) end)
                        optionButton.MouseLeave:Connect(function() Animate(optionButton, {BackgroundColor3 = Theme.Header}, 0.1) end)
                        optionButton.MouseButton1Click:Connect(function() mainButton.Text = "  "..optionText; CloseDropdown(); if dropdownProps.Callback then pcall(dropdownProps.Callback, optionText) end end)
                    end
                end
                
                isOpen = not isOpen
                Animate(arrow, {Rotation = isOpen and 180 or 0})
                
                if isOpen then 
                    optionsContainer.Visible=true
                    Animate(optionsContainer, {Size=UDim2.new(frame.AbsoluteSize.X, 0, 0, math.min(#dropdownProps.Options * 32, 150))}, 0.2)
                else 
                    CloseDropdown() 
                end
            end)
            return {}
        end

        return setmetatable(Tab, {__index = elementMethods})
    end

    return self
end

return Library
